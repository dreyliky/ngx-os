<ng-container
    *ngTemplateOutlet="treeNodesTemplate; context: { nodes: data, depth: 0 }">
</ng-container>

<ng-template
    #treeNodesTemplate
    let-nodes="nodes"
    let-depth="depth">
    <ng-container *ngFor="let node of nodes">
        <div
            class="os-tree-node"
            [style.--os-tree-node-depth]="depth"
            [class.os-expandable]="node.children?.length"
            [class.os-flat]="!node.children?.length"
            [class.os-expanded]="isNodeExpanded(node)"
            [class.os-selected]="isNodeSelected(node)"
            (click)="onNodeClick(node)">
            <div
                class="os-icon"
                (click)="onToggleExpandButtonClick($event, node)">
            </div>

            <div class="os-label">{{ node.label }}</div>
        </div>

        <ng-container *ngIf="node?.children && isNodeExpanded(node)">
            <ng-container
                *ngTemplateOutlet="treeNodesTemplate; context: { nodes: node.children, depth: depth + 1 }">
            </ng-container>
        </ng-container>
    </ng-container>
</ng-template>
