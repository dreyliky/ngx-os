<ng-container
    *ngTemplateOutlet="treeNodesTemplate; context: { nodes: data, depth: 0 }">
</ng-container>

<ng-template
    #treeNodesTemplate
    let-nodes="nodes"
    let-depth="depth">
    <ng-container *ngFor="let node of nodes">
        <div
            class="os-tree-node"
            tabindex="0"
            [style.--os-tree-node-depth]="depth"
            [ngStyle]="node.style"
            [ngClass]="node.styleClass"
            [class.os-root-node]="!depth"
            [class.os-disabled]="node.isDisabled"
            [class.os-expandable]="node.children?.length"
            [class.os-flat]="!node.children?.length"
            [class.os-expanded]="nodesExpansion.isExpanded(node)"
            [class.os-selected]="nodesSelection.isSelected(node)"
            (click)="onNodeClick($event, node)">
            <div
                class="os-icon"
                [ngClass]="node.iconStyleClass"
                [ngStyle]="node.iconStyle"
                (click)="onToggleExpandButtonClick($event, node)">
            </div>

            <div
                *ngIf="!_nodeTemplate; else wrapperForNodeTemplate"
                class="os-label">
                {{ node.label }}
            </div>

            <ng-template #wrapperForNodeTemplate>
                <ng-container
                    *ngTemplateOutlet="_nodeTemplate; context: { node: node }">
                </ng-container>
            </ng-template>
        </div>

        <ng-container *ngIf="node?.children && nodesExpansion.isExpanded(node)">
            <ng-container
                *ngTemplateOutlet="treeNodesTemplate; context: { nodes: node.children, depth: depth + 1 }">
            </ng-container>
        </ng-container>
    </ng-container>
</ng-template>
